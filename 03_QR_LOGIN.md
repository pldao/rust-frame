# æ‰«ç ç™»å½•åŠŸèƒ½å®Œæ•´æ–‡æ¡£

> **æ ¸å¿ƒç‰¹æ€§ï¼šåç«¯ç›´æ¥ç”ŸæˆPNGäºŒç»´ç å›¾ç‰‡ï¼Œå‰ç«¯é›¶ä¾èµ–ï¼**

## ğŸ“– ç›®å½•

- [æ¶æ„è®¾è®¡](#æ¶æ„è®¾è®¡)
- [æ•°æ®æµç¨‹](#æ•°æ®æµç¨‹)
- [å¿«é€Ÿå¼€å§‹](#å¿«é€Ÿå¼€å§‹)
- [æ•°æ®åº“è®¾è®¡](#æ•°æ®åº“è®¾è®¡)
- [å‰ç«¯é›†æˆ](#å‰ç«¯é›†æˆ)
- [Appç«¯é›†æˆ](#appç«¯é›†æˆ)
- [å®‰å…¨æœºåˆ¶](#å®‰å…¨æœºåˆ¶)

---

## ğŸ— æ¶æ„è®¾è®¡

### æ•´ä½“æ¶æ„å›¾

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         æ‰«ç ç™»å½•ç³»ç»Ÿæ¶æ„                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              â”‚              â”‚              â”‚              â”‚              â”‚
â”‚   ç½‘é¡µç«¯     â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚   åç«¯API    â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚   Appç«¯      â”‚
â”‚   (Web)      â”‚   HTTP/JSON  â”‚   (Rust)     â”‚   HTTP/JSON  â”‚   (Mobile)   â”‚
â”‚              â”‚              â”‚              â”‚              â”‚              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                     â”‚
                                     â”‚ SQL
                                     â–¼
                              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                              â”‚              â”‚
                              â”‚  PostgreSQL  â”‚
                              â”‚   Database   â”‚
                              â”‚              â”‚
                              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                          æŠ€æœ¯æ ˆ                                  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ åç«¯ï¼šRust + Actix-Web + SeaORM + PostgreSQL                    â”‚
â”‚ è®¤è¯ï¼šJWT (EdDSAç­¾å)                                            â”‚
â”‚ äºŒç»´ç ï¼šqrcode + image (åç«¯ç”ŸæˆPNG)                             â”‚
â”‚ å‰ç«¯ï¼šåŸç”ŸHTML/JS (æ— éœ€ä»»ä½•åº“)                                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### æ ¸å¿ƒç»„ä»¶

```
scaffold/
â”œâ”€â”€ src/backend/
â”‚   â”œâ”€â”€ models/
â”‚   â”‚   â””â”€â”€ qr_login_sessions.rs      â† æ•°æ®æ¨¡å‹ï¼ˆSeaORMï¼‰
â”‚   â”‚
â”‚   â””â”€â”€ api/qr_login/
â”‚       â”œâ”€â”€ mod.rs                     â† è·¯ç”±å®šä¹‰
â”‚       â”œâ”€â”€ generate_qr.rs             â† ç”ŸæˆäºŒç»´ç ï¼ˆå«PNGå›¾ç‰‡ï¼‰
â”‚       â”œâ”€â”€ check_status.rs            â† æŸ¥è¯¢çŠ¶æ€ï¼ˆè½®è¯¢ï¼‰
â”‚       â”œâ”€â”€ confirm_login.rs           â† ç¡®è®¤ç™»å½•ï¼ˆAppè°ƒç”¨ï¼‰
â”‚       â””â”€â”€ handle_qr_session.rs       â† æ•°æ®åº“æ“ä½œ
â”‚
â”œâ”€â”€ migrations/
â”‚   â””â”€â”€ 001_create_qr_login_sessions.sql  â† æ•°æ®åº“è¿ç§»
â”‚
â””â”€â”€ examples/
    â””â”€â”€ qr_login_simple.html           â† å‰ç«¯ç¤ºä¾‹
```

---

## ğŸ”„ æ•°æ®æµç¨‹

### å®Œæ•´æ—¶åºå›¾

```
ç½‘é¡µç«¯                    åç«¯API                   æ•°æ®åº“                Appç«¯
  â”‚                         â”‚                        â”‚                     â”‚
  â”‚â”€1â”€POST /generateâ”€â”€â”€â”€â”€â”€â”€â–ºâ”‚                        â”‚                     â”‚
  â”‚   {client_info}         â”‚                        â”‚                     â”‚
  â”‚                         â”‚                        â”‚                     â”‚
  â”‚                         â”‚â”€INSERT qr_sessionâ”€â”€â”€â”€â”€â–ºâ”‚                     â”‚
  â”‚                         â”‚  status='pending'      â”‚                     â”‚
  â”‚                         â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚                     â”‚
  â”‚                         â”‚                        â”‚                     â”‚
  â”‚                         â”‚ ğŸ¨ ç”ŸæˆäºŒç»´ç PNG        â”‚                     â”‚
  â”‚                         â”‚ ğŸ“¦ Base64ç¼–ç           â”‚                     â”‚
  â”‚                         â”‚                        â”‚                     â”‚
  â”‚â—„â”€â”€â”€ qr_image + id â”€â”€â”€â”€â”€â”€â”‚                        â”‚                     â”‚
  â”‚   {session_id,          â”‚                        â”‚                     â”‚
  â”‚    qr_image: "data:..."}â”‚                        â”‚                     â”‚
  â”‚                         â”‚                        â”‚                     â”‚
  â”‚  æ˜¾ç¤ºäºŒç»´ç å›¾ç‰‡           â”‚                        â”‚                     â”‚
  â”‚                         â”‚                        â”‚                     â”‚
  â”‚â”€2â”€GET /status/{id}â”€â”€â”   â”‚                        â”‚                     â”‚
  â”‚   (æ¯2ç§’è½®è¯¢)        â”‚   â”‚                        â”‚                     â”‚
  â”‚â—„â”€â”€â”€â”€pendingâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚                        â”‚                     â”‚
  â”‚                         â”‚                        â”‚                     â”‚
  â”‚                         â”‚                        â”‚  ğŸ“± ç”¨æˆ·æ‰«ç            â”‚
  â”‚                         â”‚                        â”‚     è·å–session_id    â”‚
  â”‚                         â”‚                        â”‚                     â”‚
  â”‚                         â”‚                        â”‚     æ˜¾ç¤ºç¡®è®¤å¯¹è¯æ¡†     â”‚
  â”‚                         â”‚                        â”‚                     â”‚
  â”‚                         â”‚â—„â”€3â”€POST /confirmâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
  â”‚                         â”‚   {session_id,         â”‚                     â”‚
  â”‚                         â”‚    app_token}          â”‚                     â”‚
  â”‚                         â”‚                        â”‚                     â”‚
  â”‚                         â”‚  éªŒè¯app_token(JWT)     â”‚                     â”‚
  â”‚                         â”‚  è§£æuser_id           â”‚                     â”‚
  â”‚                         â”‚                        â”‚                     â”‚
  â”‚                         â”‚â”€UPDATE statusâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚                     â”‚
  â”‚                         â”‚  'confirmed'           â”‚                     â”‚
  â”‚                         â”‚  web_tokenç”Ÿæˆ         â”‚                     â”‚
  â”‚                         â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚                     â”‚
  â”‚                         â”‚                        â”‚                     â”‚
  â”‚                         â”‚â”€â”€â”€ success â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚
  â”‚                         â”‚                        â”‚                     â”‚
  â”‚â”€4â”€GET /status/{id}â”€â”€â”€â”€â”€â–ºâ”‚                        â”‚                     â”‚
  â”‚                         â”‚â”€SELECTâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚                     â”‚
  â”‚                         â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚                     â”‚
  â”‚â—„â”€â”€â”€ confirmed + token â”€â”€â”‚                        â”‚                     â”‚
  â”‚   {status: "confirmed", â”‚                        â”‚                     â”‚
  â”‚    web_token: "..."}    â”‚                        â”‚                     â”‚
  â”‚                         â”‚                        â”‚                     â”‚
  â”‚  ä¿å­˜token              â”‚                        â”‚                     â”‚
  â”‚  ç™»å½•æˆåŠŸï¼             â”‚                        â”‚                     â”‚
  â”‚                         â”‚                        â”‚                     â”‚

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ çŠ¶æ€è½¬æ¢ï¼špending â†’ confirmed/rejected/expired                       â”‚
â”‚ æœ‰æ•ˆæœŸï¼š300ç§’ï¼ˆ5åˆ†é’Ÿï¼‰                                                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### çŠ¶æ€æœº

```
                        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                        â”‚          â”‚
                    â”Œâ”€â”€â–ºâ”‚ pending  â”‚â—„â”€â”€â” åˆå§‹çŠ¶æ€
                    â”‚   â”‚          â”‚   â”‚
                    â”‚   â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜   â”‚
                    â”‚         â”‚        â”‚
         è¶…æ—¶/5åˆ†é’Ÿ â”‚         â”‚ ç”¨æˆ·æ“ä½œ â”‚ åˆ›å»ºä¼šè¯
                    â”‚         â”‚        â”‚
                    â”‚    â”Œâ”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”  â”‚
                    â”‚    â”‚          â”‚  â”‚
                    â”œâ”€â”€â”€â–ºâ”‚confirmed â”‚  â”‚ Appç¡®è®¤
                    â”‚    â”‚          â”‚  â”‚
                    â”‚    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
                    â”‚                  â”‚
                    â”‚    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
                    â”‚    â”‚          â”‚  â”‚
                    â””â”€â”€â”€â–ºâ”‚ rejected â”‚  â”‚ Appæ‹’ç»
                    â”‚    â”‚          â”‚  â”‚
                    â”‚    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
                    â”‚                  â”‚
                    â”‚    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
                    â”‚    â”‚          â”‚  â”‚
                    â””â”€â”€â”€â–ºâ”‚ expired  â”‚  â”‚ è¶…æ—¶
                         â”‚          â”‚  â”‚
                         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
                                       â”‚
                              åˆ›å»ºæ–°ä¼šè¯æ—¶è‡ªåŠ¨æ¸…ç†
```

---

## ğŸš€ å¿«é€Ÿå¼€å§‹

### 1. æ•°æ®åº“å‡†å¤‡

```bash
# è¿æ¥åˆ°PostgreSQL
psql -U postgres

# åˆ›å»ºæ•°æ®åº“ï¼ˆå¦‚æœéœ€è¦ï¼‰
CREATE DATABASE your_database;

# è¿è¡Œè¿ç§»
\c your_database
\i scaffold/migrations/001_create_qr_login_sessions.sql
```

### 2. å¯åŠ¨æœåŠ¡

```bash
cd scaffold

# æ–¹å¼1ï¼šä½¿ç”¨é»˜è®¤é…ç½®
cargo run --release

# æ–¹å¼2ï¼šæŒ‡å®šå‚æ•°
cargo run --release -- \
  --pgsql-url "postgres://postgres:postgres@localhost:5432/your_database" \
  --backend-port 8080
```

**å¯åŠ¨æˆåŠŸè¾“å‡ºï¼š**
```
INFO scaffold: ğŸ”§ Initializing the Actix-Web server...
INFO scaffold: âœ… Successfully connected to PostgreSQL database.
INFO scaffold::backend::app_router: ğŸŒ Starting HTTP server on 0.0.0.0:8080
INFO scaffold::backend::app_router: âœ… Server listening on http://0.0.0.0:8080
INFO scaffold::backend::app_router: ğŸ“¡ QR Login API: http://localhost:8080/qr-login/generate
INFO scaffold::backend::app_router: ğŸ“ Health check: http://localhost:8080/ping
```

### 3. æµ‹è¯•

```bash
# æµ‹è¯•å¥åº·æ£€æŸ¥
curl http://localhost:8080/ping

# æµ‹è¯•ç”ŸæˆäºŒç»´ç 
curl -X POST http://localhost:8080/qr-login/generate \
  -H "Content-Type: application/json" \
  -d '{"client_info":"test"}' | jq .

# æ‰“å¼€æµ‹è¯•é¡µé¢
open scaffold/examples/qr_login_simple.html
```

---

## ğŸ—„ æ•°æ®åº“è®¾è®¡

### è¡¨ç»“æ„

```sql
CREATE TABLE qr_login_sessions (
    id SERIAL PRIMARY KEY,                    -- è‡ªå¢ä¸»é”®
    session_id VARCHAR(255) NOT NULL UNIQUE,  -- UUIDä¼šè¯ID
    status VARCHAR(50) NOT NULL,              -- çŠ¶æ€: pending/confirmed/rejected/expired
    web_token TEXT,                           -- ç”Ÿæˆçš„Webç«¯JWT token
    created_at TIMESTAMP DEFAULT NOW(),       -- åˆ›å»ºæ—¶é—´
    expires_at TIMESTAMP NOT NULL,            -- è¿‡æœŸæ—¶é—´
    confirmed_at TIMESTAMP                    -- ç¡®è®¤æ—¶é—´
);

CREATE INDEX idx_session_id ON qr_login_sessions(session_id);
CREATE INDEX idx_status ON qr_login_sessions(status);
CREATE INDEX idx_expires_at ON qr_login_sessions(expires_at);
```

### å­—æ®µè¯´æ˜

| å­—æ®µ | ç±»å‹ | è¯´æ˜ | ç¤ºä¾‹ |
|------|------|------|------|
| `id` | SERIAL | è‡ªå¢ä¸»é”® | `1` |
| `session_id` | VARCHAR(255) | UUIDä¼šè¯æ ‡è¯† | `550e8400-e29b-41d4-a716-446655440000` |
| `status` | VARCHAR(50) | ä¼šè¯çŠ¶æ€ | `pending`, `confirmed`, `rejected`, `expired` |
| `web_token` | TEXT | Webç«¯JWT | `eyJhbGciOiJFZERTQSIs...` |
| `created_at` | TIMESTAMP | åˆ›å»ºæ—¶é—´ | `2024-11-19 10:00:00` |
| `expires_at` | TIMESTAMP | è¿‡æœŸæ—¶é—´ | `2024-11-19 10:05:00` |
| `confirmed_at` | TIMESTAMP | ç¡®è®¤æ—¶é—´ | `2024-11-19 10:01:23` |

### æ•°æ®ç”Ÿå‘½å‘¨æœŸ

```
åˆ›å»º â”€â”€â”€â–º pending (5åˆ†é’Ÿæœ‰æ•ˆæœŸ)
         â”‚
         â”œâ”€â–º confirmed (ä¿ç•™7å¤©ç”¨äºå®¡è®¡)
         â”œâ”€â–º rejected  (ä¿ç•™7å¤©ç”¨äºå®¡è®¡)
         â””â”€â–º expired   (ä¿ç•™1å¤©)

è‡ªåŠ¨æ¸…ç†ï¼šå®šæœŸåˆ é™¤7å¤©å‰çš„è®°å½•
```

---

## ğŸ’» å‰ç«¯é›†æˆ

### æ ¸å¿ƒç‰¹æ€§

âœ… **é›¶ä¾èµ–** - æ— éœ€ä»»ä½•äºŒç»´ç åº“  
âœ… **3è¡Œä»£ç ** - è¶…ç®€å•é›†æˆ  
âœ… **åŸç”Ÿæ”¯æŒ** - ç›´æ¥ç”¨ `<img>` æ ‡ç­¾

### HTMLç¤ºä¾‹

```html
<!DOCTYPE html>
<html>
<head>
    <title>æ‰«ç ç™»å½•</title>
</head>
<body>
    <h1>æ‰«ç ç™»å½•</h1>
    <img id="qrImage" alt="äºŒç»´ç " style="width: 300px;">
    <div id="status">ç‚¹å‡»ç”ŸæˆäºŒç»´ç </div>
    
    <script>
        const API_BASE = 'http://localhost:8080';
        let sessionId = null;
        
        // ç”ŸæˆäºŒç»´ç 
        async function generateQR() {
            const res = await fetch(`${API_BASE}/qr-login/generate`, {
                method: 'POST',
                headers: {'Content-Type': 'application/json'},
                body: JSON.stringify({})
            });
            const data = await res.json();
            
            sessionId = data.session_id;
            document.getElementById('qrImage').src = data.qr_image; // âœ¨ ç›´æ¥æ˜¾ç¤º
            
            startPolling();
        }
        
        // è½®è¯¢çŠ¶æ€
        async function startPolling() {
            const interval = setInterval(async () => {
                const res = await fetch(`${API_BASE}/qr-login/status/${sessionId}`);
                const data = await res.json();
                
                if (data.status === 'confirmed') {
                    clearInterval(interval);
                    localStorage.setItem('token', data.web_token);
                    document.getElementById('status').textContent = 'âœ… ç™»å½•æˆåŠŸï¼';
                }
            }, 2000);
        }
        
        generateQR();
    </script>
</body>
</html>
```

### Reacté›†æˆ

```jsx
import { useState, useEffect } from 'react';

function QRLogin() {
  const [qrImage, setQrImage] = useState('');
  const [sessionId, setSessionId] = useState('');
  const [status, setStatus] = useState('');
  
  // ç”ŸæˆäºŒç»´ç 
  const generateQR = async () => {
    const res = await fetch('http://localhost:8080/qr-login/generate', {
      method: 'POST',
      headers: {'Content-Type': 'application/json'},
      body: JSON.stringify({})
    });
    const data = await res.json();
    setQrImage(data.qr_image);
    setSessionId(data.session_id);
  };
  
  // è½®è¯¢çŠ¶æ€
  useEffect(() => {
    if (!sessionId) return;
    
    const interval = setInterval(async () => {
      const res = await fetch(`http://localhost:8080/qr-login/status/${sessionId}`);
      const data = await res.json();
      
      setStatus(data.status);
      if (data.status === 'confirmed') {
        clearInterval(interval);
        localStorage.setItem('token', data.web_token);
      }
    }, 2000);
    
    return () => clearInterval(interval);
  }, [sessionId]);
  
  return (
    <div>
      <h1>æ‰«ç ç™»å½•</h1>
      {!qrImage ? (
        <button onClick={generateQR}>ç”ŸæˆäºŒç»´ç </button>
      ) : (
        <>
          <img src={qrImage} alt="äºŒç»´ç " />
          <p>{status === 'confirmed' ? 'âœ… ç™»å½•æˆåŠŸ' : 'â³ ç­‰å¾…æ‰«ç ...'}</p>
        </>
      )}
    </div>
  );
}
```

### Vueé›†æˆ

```vue
<template>
  <div>
    <h1>æ‰«ç ç™»å½•</h1>
    <button v-if="!qrImage" @click="generateQR">ç”ŸæˆäºŒç»´ç </button>
    <div v-else>
      <img :src="qrImage" alt="äºŒç»´ç ">
      <p>{{ statusText }}</p>
    </div>
  </div>
</template>

<script setup>
import { ref, watch, computed } from 'vue'

const qrImage = ref('')
const sessionId = ref('')
const status = ref('')

const statusText = computed(() => {
  return status.value === 'confirmed' ? 'âœ… ç™»å½•æˆåŠŸ' : 'â³ ç­‰å¾…æ‰«ç ...'
})

const generateQR = async () => {
  const res = await fetch('http://localhost:8080/qr-login/generate', {
    method: 'POST',
    headers: {'Content-Type': 'application/json'},
    body: JSON.stringify({})
  })
  const data = await res.json()
  qrImage.value = data.qr_image
  sessionId.value = data.session_id
  startPolling()
}

const startPolling = () => {
  const interval = setInterval(async () => {
    const res = await fetch(`http://localhost:8080/qr-login/status/${sessionId.value}`)
    const data = await res.json()
    status.value = data.status
    
    if (data.status === 'confirmed') {
      clearInterval(interval)
      localStorage.setItem('token', data.web_token)
    }
  }, 2000)
}
</script>
```

---

## ğŸ“± Appç«¯é›†æˆ

### Flutterç¤ºä¾‹

```dart
import 'package:flutter/material.dart';
import 'package:mobile_scanner/mobile_scanner.dart';
import 'package:http/http.dart' as http;
import 'dart:convert';

class QRScanner extends StatelessWidget {
  final String appToken; // ç”¨æˆ·çš„JWT token
  
  const QRScanner({required this.appToken});
  
  @override
  Widget build(BuildContext context) {
    return MobileScanner(
      onDetect: (capture) async {
        final String? code = capture.barcodes.first.rawValue;
        if (code == null) return;
        
        // è§£æäºŒç»´ç æ•°æ®
        final qrData = jsonDecode(code);
        final sessionId = qrData['session_id'];
        
        // æ˜¾ç¤ºç¡®è®¤å¯¹è¯æ¡†
        final confirmed = await showDialog<bool>(
          context: context,
          builder: (context) => AlertDialog(
            title: Text('ç¡®è®¤ç™»å½•'),
            content: Text('æ˜¯å¦åœ¨ç½‘é¡µç«¯ç™»å½•ï¼Ÿ'),
            actions: [
              TextButton(
                onPressed: () => Navigator.pop(context, false),
                child: Text('å–æ¶ˆ'),
              ),
              TextButton(
                onPressed: () => Navigator.pop(context, true),
                child: Text('ç¡®è®¤'),
              ),
            ],
          ),
        );
        
        if (confirmed == true) {
          await confirmLogin(sessionId);
        }
      },
    );
  }
  
  Future<void> confirmLogin(String sessionId) async {
    final response = await http.post(
      Uri.parse('http://api.example.com/qr-login/confirm'),
      headers: {'Content-Type': 'application/json'},
      body: jsonEncode({
        'session_id': sessionId,
        'app_token': appToken,
      }),
    );
    
    if (response.statusCode == 200) {
      // ç™»å½•ç¡®è®¤æˆåŠŸ
      print('ç™»å½•ç¡®è®¤æˆåŠŸ');
    }
  }
}
```

### React Nativeç¤ºä¾‹

```javascript
import React, { useState } from 'react';
import { View, Text, Button, Alert } from 'react-native';
import { RNCamera } from 'react-native-camera';

const QRScanner = ({ appToken }) => {
  const onBarCodeRead = async ({ data }) => {
    try {
      const qrData = JSON.parse(data);
      const { session_id } = qrData;
      
      Alert.alert(
        'ç¡®è®¤ç™»å½•',
        'æ˜¯å¦åœ¨ç½‘é¡µç«¯ç™»å½•ï¼Ÿ',
        [
          { text: 'å–æ¶ˆ', style: 'cancel' },
          { 
            text: 'ç¡®è®¤', 
            onPress: async () => {
              await fetch('http://api.example.com/qr-login/confirm', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({
                  session_id,
                  app_token: appToken
                })
              });
              Alert.alert('æˆåŠŸ', 'ç™»å½•ç¡®è®¤æˆåŠŸ');
            }
          }
        ]
      );
    } catch (e) {
      Alert.alert('é”™è¯¯', 'äºŒç»´ç æ ¼å¼é”™è¯¯');
    }
  };
  
  return (
    <RNCamera
      onBarCodeRead={onBarCodeRead}
      style={{ flex: 1 }}
    />
  );
};
```

---

## ğŸ”’ å®‰å…¨æœºåˆ¶

### JWTéªŒè¯

```rust
// éªŒè¯Appç«¯token
pub fn verify_jwt(token: &str) -> Result<TokenData<Claims>, Error> {
    let (_, decoding_key) = load_keys();
    let mut validation = Validation::new(Algorithm::EdDSA);
    validation.validate_exp = true;
    decode::<Claims>(token, &decoding_key, &validation)
}
```

### å®‰å…¨ç‰¹æ€§

| ç‰¹æ€§ | å®ç° | è¯´æ˜ |
|------|------|------|
| **ä¼šè¯æœ‰æ•ˆæœŸ** | 5åˆ†é’Ÿ | è¶…æ—¶è‡ªåŠ¨è¿‡æœŸ |
| **ä¸€æ¬¡æ€§ä½¿ç”¨** | ç¡®è®¤åçŠ¶æ€å˜æ›´ | é˜²æ­¢é‡æ”¾æ”»å‡» |
| **JWTç­¾å** | EdDSA | éå¯¹ç§°åŠ å¯†ç­¾å |
| **tokenè¿‡æœŸ** | expå­—æ®µéªŒè¯ | JWTè‡ªå¸¦è¿‡æœŸæœºåˆ¶ |
| **HTTPS** | ç”Ÿäº§ç¯å¢ƒå¿…é¡» | é˜²æ­¢ä¸­é—´äººæ”»å‡» |
| **UUIDä¼šè¯ID** | v4éšæœºç”Ÿæˆ | ä¸å¯é¢„æµ‹ |

### å®‰å…¨å»ºè®®

1. **ç”Ÿäº§ç¯å¢ƒå¿…é¡»ä½¿ç”¨HTTPS**
2. **å®šæœŸæ¸…ç†è¿‡æœŸä¼šè¯è®°å½•**
3. **é™åˆ¶è½®è¯¢é¢‘ç‡ï¼ˆå»ºè®®2-3ç§’ï¼‰**
4. **Appç«¯tokenéœ€è¦å®‰å…¨å­˜å‚¨**
5. **è®°å½•å®¡è®¡æ—¥å¿—**

---

## ğŸ“Š æ€§èƒ½æŒ‡æ ‡

| æŒ‡æ ‡ | æ•°å€¼ | è¯´æ˜ |
|------|------|------|
| äºŒç»´ç ç”Ÿæˆæ—¶é—´ | ~10ms | 300x300 PNG |
| Base64ç¼–ç åå¤§å° | 2-5KB | å¯ç›´æ¥åµŒå…¥JSON |
| æ•°æ®åº“æŸ¥è¯¢ | <5ms | æœ‰ç´¢å¼•ä¼˜åŒ– |
| è½®è¯¢é—´éš” | 2ç§’ | å¹³è¡¡ä½“éªŒå’Œæ€§èƒ½ |
| å¹¶å‘æ”¯æŒ | 1000+ | Actix-Webå¼‚æ­¥ |

---

## ğŸ¯ ä¼˜åŠ¿æ€»ç»“

### vs ä¼ ç»Ÿæ–¹å¼

| å¯¹æ¯”é¡¹ | ä¼ ç»Ÿæ–¹å¼ | æœ¬æ–¹æ¡ˆ |
|--------|---------|--------|
| å‰ç«¯ä¾èµ– | qrcode.js (~50KB) | âœ… é›¶ä¾èµ– |
| å‰ç«¯ä»£ç  | ~20è¡Œ | âœ… 3è¡Œ |
| äºŒç»´ç ç”Ÿæˆ | å‰ç«¯è®¡ç®— | âœ… åç«¯ç”Ÿæˆ |
| æ ·å¼æ§åˆ¶ | å‰ç«¯å„è‡ªå®ç° | âœ… åç«¯ç»Ÿä¸€ |
| æ€§èƒ½ | å‰ç«¯è®¡ç®—æ¶ˆè€— | âœ… æœåŠ¡å™¨å¤„ç† |
| ç»´æŠ¤æˆæœ¬ | é«˜ | âœ… ä½ |

---

## ğŸ“š ç›¸å…³æ–‡æ¡£

- **APIè¯¦ç»†æ–‡æ¡£ï¼š** [QR_LOGIN_API.md](./QR_LOGIN_API.md)
- **æ”¹åŠ¨æ¸…å•ï¼š** [CHANGES.md](./CHANGES.md)
- **æµ‹è¯•é¡µé¢ï¼š** [scaffold/examples/qr_login_simple.html](./scaffold/examples/qr_login_simple.html)

---

## ğŸ› æ•…éšœæ’æŸ¥

### æœåŠ¡å™¨å¯åŠ¨åç«‹å³é€€å‡º

**é—®é¢˜ï¼š** ç«¯å£è¢«å ç”¨

```bash
# æ£€æŸ¥ç«¯å£
lsof -i :8080

# æ€æ­»å ç”¨è¿›ç¨‹
kill -9 <PID>

# æˆ–ä½¿ç”¨å…¶ä»–ç«¯å£
./target/release/scaffold --backend-port 8081
```

### äºŒç»´ç ç”Ÿæˆå¤±è´¥

**é—®é¢˜ï¼š** ä¾èµ–æœªå®‰è£…

```bash
# é‡æ–°ç¼–è¯‘
cd scaffold
cargo clean
cargo build --release
```

### æ•°æ®åº“è¿æ¥å¤±è´¥

**é—®é¢˜ï¼š** æ•°æ®åº“ä¸å­˜åœ¨æˆ–è¿æ¥å­—ç¬¦ä¸²é”™è¯¯

```bash
# æ£€æŸ¥æ•°æ®åº“
psql -U postgres -l

# åˆ›å»ºæ•°æ®åº“
createdb your_database

# è¿è¡Œè¿ç§»
psql -U postgres -d your_database -f scaffold/migrations/001_create_qr_login_sessions.sql
```

---

**ç‰ˆæœ¬ï¼š** 1.0.0  
**æœ€åæ›´æ–°ï¼š** 2024-11-19  
**çŠ¶æ€ï¼š** âœ… ç”Ÿäº§å°±ç»ª
